<% if @booking %>
  items_json = <%= raw @booking.booking_items_to_json %>;
  submit_json.id = <%= @booking.id %>;
  submit_json['payment_methods'] = {<%= @booking.id %>:{}};
  submit_json['totals'] = {<%= @booking.id %>:{model:<%= @booking.sum %>, payment_methods:0, booking_orders:<%= @booking.orders.sum :sum %>}};
  $('.booking_form').attr('id', 'model_<%= @booking.id %>');
  $('.booking_change').attr('id', 'change_<%= @booking.id %>');
  $('#booking_from').val('<%= @booking.from.strftime("%Y-%m-%d") if @booking.from %>');
  $('#booking_to').val('<%= @booking.to.strftime("%Y-%m-%d") if @booking.to %>');
  $('#booking_duration').val('<%= Integer(@booking.duration) %>');
  $('#add_payment_method_button').on('click', function() { add_payment_method(<%= @booking.id %>); });
  $('.payment_methods_container').attr('id', 'payment_methods_container_' + <%= @booking.id %>);
  $('#booking_totals').append('<%= escape_javascript raw render(:partial => '/bookings/totals_list', :locals => { :booking => @booking }) %>');
  window.change_season(<%= @booking.season.id %>);
<% else %>
  submit_json.id = 0;
  submit_json['payment_methods'] = {0:{}};
  submit_json['totals'] = {0:{model:0, payment_methods:0, booking_orders:0}};
  $('#add_payment_method_button').on('click', function() { add_payment_method(0); });
  $('.payment_methods_container').attr('id', 'payment_methods_container_0');
  $('#booking_from').val('<%= Time.now.strftime("%Y-%m-%d") %>');
  submit_json.model.from = '<%= Time.now.strftime("%Y-%m-%d") %>';
  $('#booking_to').val('<%= (Time.now + 1.day).strftime("%Y-%m-%d") %>');
  submit_json.model.to = '<%= (Time.now + 1.day).strftime("%Y-%m-%d") %>';
  window.calculate_booking_duration();
  $('.booking_form').attr('id', 'model_0');
  $('.booking_change').attr('id', 'change_0');
  $('#booking_totals').append('<%= escape_javascript raw render(:partial => '/bookings/totals_list', :locals => { :booking => Booking.new }) %>');
<% end %>
//window.initialize_booking_form();
