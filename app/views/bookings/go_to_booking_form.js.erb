<% if @booking %>
  items_json = <%= raw @booking.booking_items_to_json %>;
  submit_json.id = <%= @booking.id %>;
  submit_json['payment_methods'] = {<%= @booking.id %>:{}};
  submit_json['totals'] = {<%= @booking.id %>:{model:<%= @booking.sum %>, payment_methods:0, booking_orders:<%= @booking.orders.sum :sum %>}};
  $('.booking_form').attr('id', 'model_<%= @booking.id %>');
  $('.booking_change').attr('id', 'change_<%= @booking.id %>');
  $('#booking_from').val('<%= @booking.from.strftime("%Y-%m-%d") if @booking.from %>');
  $('#booking_to').val('<%= @booking.to.strftime("%Y-%m-%d") if @booking.to %>');
  $('#booking_duration').val('<%= Integer(@booking.duration) %>');
  $('#add_payment_method_button').on('click', function() { add_payment_method(<%= @booking.id %>); });
  $('#booking_totals').append('<%= escape_javascript raw render(:partial => '/bookings/totals_list', :locals => { :booking => @booking }) %>');
  window.render_booking_items_from_json();
<% else %>
  submit_json.id = 0;
  submit_json['payment_methods'] = {0:{}};
  submit_json['totals'] = {0:{model:0, payment_methods:0}};
  $('#add_payment_method_button').on('click', function() { add_payment_method(0); });
  $('.booking_form').attr('id', 'model_0');
  $('.booking_change').attr('id', 'change_0');
<% end %>
