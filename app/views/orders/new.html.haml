%h2= @order.id ? "#{t :order, :count => 1} ##{@order.id}, #{Table.find(@order.table_id).name}" : "#{t :new_order} #{Table.find(@order.table_id).name}"

= error_messages_for 'order'

- path = controller.action_name == 'edit' ? table_order_path(@order.table_id, @order) : table_orders_path
- method = controller.action_name == 'edit' ? 'put' : 'post'

- form_for :order, @order, :url => path, :html => { :method => method } do |order_form|
  %p
    = order_form.label(:user_id, (t :user))
    = order_form.collection_select :user_id, User.all, :id, :login, { :include_blank => true }

  - if @current_user.role >= 10 
    %p
      = order_form.label(:created_at, (t :creation_date))
      = order_form.date_select :created_at

  %table#items
    %th.count= t :count
    %th.article= t :article
    %th.checkbox= t :cost_center
    %th.checkbox= t :partial_order
    - order_form.fields_for :items do |item_form|
      - nested_attribute_id = /order\[items_attributes\]\[(.*)\]/.match(item_form.object_name)[1]
      %tr
        %td
          %select{ :id => "order_items_attributes_#{ nested_attribute_id }_count", :name => "order[items_attributes][#{ nested_attribute_id }][count]" }
            = options_for_select MyGlobals::predefined_count, item_form.object.count
        %td
          %select{ :id => "order_items_attributes_#{ nested_attribute_id }_article_id", :name => "order[items_attributes][#{ nested_attribute_id }][article_id]" }
            %option{ :value => '' }
            = option_groups_from_collection_for_select Category.all, :articles_in_menucard, :name, :id, :name, item_form.object.article_id
        %td
          %select{ :id => "order_items_attributes_#{ nested_attribute_id }_cost_center_id", :name => "order[items_attributes][#{ nested_attribute_id }][cost_center_id]" }
            = options_from_collection_for_select @active_cost_centers, :id, :name, item_form.object.cost_center_id

        %td= item_form.check_box :partial_order

  %p
    = t :add_article
    - @categories.each do |category|
      - item_category_caption = "<div class='item_category #{category.name.delete " "}'>#{category.name}</div>"
      %span= add_item_link item_category_caption, order_form, category, @active_cost_centers

  .clear

  - if controller.action_name == 'new'
    %p= submit_tag( (t :create), :class => 'create_edit_order' )
  - else
    %p= submit_tag( "#{t :save}", :class => 'create_edit_order', :name => 'edit_order' )
    %p= submit_tag( "#{t :finished}", :class => 'create_edit_order', :name => 'finish_order' )
