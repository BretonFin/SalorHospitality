%script{ :type => 'text/javascript' }= generate_js_variables(@categories)
%script{ :type => 'text/javascript' }= generate_js_functions
%script{ :type => 'text/javascript' }= onload_functions

- path = controller.action_name == 'edit' ? table_order_path(@order.table_id, @order) : table_orders_path
- method = controller.action_name == 'edit' ? 'put' : 'post'

- form_for :order, @order, :url => path, :html => { :method => method, :name => 'itemform' } do |order_form|

  %div.waiter
    = order_form.collection_select :user_id, User.all, :id, :login, { :include_blank => true }

  .order_info
    = @order.id ? "#{t :order, :count => 1} ##{@order.id}" : t(:new_order)
    %br
    = @order.table.name


  - if @current_user.role >= 10 
    %p
      = order_form.label(:created_at, (t :creation_date))
      = order_form.date_select :created_at

  %div#categories
    - @categories.each do |category|
      %div{ :class => "category #{ category.name.delete ' ' }", :style => "background-color: #{category.color}; background-image: url('/images/category_#{category.icon}.png')", :onmousedown => "display_articles(#{ category.id }); deselect_all_categories()", :onmouseup => 'highlight_button(this)' }
        %div{ :class => "category_label" }
          %span= category.name
  
  
  %div#articles
    %table#articlestable
  
  
  %div#quantities
    %table#quantitiestable
  
  %div#items
    %div.ordersum_container
      SUMME
      %input#order_sum{ :value => number_with_precision(@order.sum, :precision => 2) } â‚¬
    %table#itemstable
      - order_form.fields_for :items do |item_form|
  
        - item = item_form.object
        - @designator = /order\[items_attributes\]\[(.*)\]/.match(item_form.object_name)[1] # nested_attribute_id
        - @sort = item.sort
        - @articleid = item.article_id
        - @price = item.quantity ? item.quantity.price : item.article.price
        - @quantityid = item.quantity_id
        - @count = item.count
        - @label = compose_item_label(item.quantity ? item.quantity : item.article)
                                
        = render 'items/item', :locals => { :sort => @sort, :articleid => @articleid, :quantityid => @quantityid , :itemname => @itemname, :designator => @designator, :count => @count, :price => @price }
  
  
  %div#functions
    %div#scrolldown{ :onclick => 'Effect.ScrollTo("footer", 100);' }
      %img{ :src => '/images/button_scrolldown.jpg' }
      
    %input#save_order{ :name => 'edit_order', :type => 'image', :src => '/images/button_tables.jpg' }
    %input#finish_order{ :name => 'finish_order', :type => 'image', :src => '/images/button_invoice.jpg' }
    
    %a{ :href => '/orders' }
      %img{ :src => '/images/button_cancel.jpg' }

  %div#footer
    %div#scrollup{ :onclick => 'Effect.ScrollTo("container", 100);' }
      %img{ :src => '/images/button_scrollup.jpg' }
