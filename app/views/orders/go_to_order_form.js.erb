<%
designator = 0
inputfields = ''
tablerows = ''
%>

<%= generate_js_variables %>

$('#order_sum').val('0' + i18n_decimal_separator + '00');
$('#order_id').val('');
$('#order_user_id').val(<%= @current_user.id %>);
$('#order_action').val('');
$('#target_table').val('');


$('#order_info').html('<%= escape_javascript t('orders.order.new') %> <%= escape_javascript @table.name %>');

<% if @order
  @order.items.sequence.each do |item|
    designator += 1
    id = item.id
    sort = item.sort
    articleid = item.article_id
    price = item.price
    quantityid = item.quantity_id
    count = item.count
    usage = item.usage
    printed_count = item.printed_count
    comment = item.comment
    label = compose_item_label(item)
    optionslist = item.optionslist
    optionsnames = compose_option_names(item)

    tablerows += render :partial => 'items/item_tablerow', :locals => { :item => item, :label => label, :designator => designator, :count => count, :comment => comment, :price => price, :optionsnames => optionsnames }

    inputfields += render :partial => 'items/item_inputfields', :locals => { :item => item, :id => id, :sort => sort, :articleid => articleid, :quantityid => quantityid, :designator => designator, :count => count, :printed_count => printed_count, :comment => comment, :price => price, :optionslist => optionslist, :usage => usage }

  end %>

$('#inputfields').append('<%= escape_javascript raw inputfields %>');
$('#itemstable').append('<%= escape_javascript raw tablerows %>');

$('#order_info').html(' <%= escape_javascript Order.model_name.human %> #<%= @order.nr %>  <%= escape_javascript @table.name %>');
$('#order_id').val('<%= @order.id %>');
$('#order_user_id').val('<%= @order.user.id if @order.user %>');
$('#order_sum').val('<%= number_with_precision(@order.sum, :precision => 2) %>');

<% end %>

$('#order_table_id').val(<%= @table.id %>);

$('#orderform').show();
$('#invoices').hide();
$('#functions_header_index').hide();
$('#functions_header_invoice_form').hide();
$('#functions_header_order_form').show();
$('#functions_footer').show();

tableupdates = -1;
new_order = <%= @order ? 'false' : 'true' %>;
