<%= "\e@" %>
<% friendly_unit = I18n.t('number.currency.format.friendly_unit', :locale => @region) %>

<%= I18n.l @from, :format => :date_iso %> -> <%= I18n.l @to, :format => :date_iso %>


<%= I18n.t('activerecord.models.cost_center.one') %>: <%= @selected_cost_center ? @selected_cost_center.name : I18n.t('settlements.index.all_cost_centers') %>

<% if permit('statistics_weekday') #---------------------------- %>


<%= "\e!\x38" %>
<%= I18n.t 'statistics.index.weekday' %>

<%= "\e!\x00" %>
<% i = 0 %>
<% total = 0 %>
<% @days.each do |day| %>
<% sum = @current_vendor.orders.existing.where(:paid => true, :settlement_id => @settlement_ids, :cost_center_id => @scids).where("WEEKDAY(finished_at) = #{i}").sum(:sum) %>
<%= "%10.10s     %s %7.2f\n" % [day, friendly_unit, sum] %>
<% i += 1 %>
<% total += sum %>
<% end %>
<%= "%10.10s     %s %7.2f\n" % [I18n.t(:sum), friendly_unit, total] %>
<%= "\xc4" * 42 %>
<% end %>

<% if permit('statistics_hour') #---------------------------- %>


<%= "\e!\x38" %>
<%= I18n.t 'statistics.index.hour' %>

<%= "\e!\x00" %>
<% total = 0 %>
<% 8.upto(23).each do |hour| %>
<% if @weekday %>
<% sum = @current_vendor.orders.existing.where(:paid => true, :settlement_id => @settlement_ids, :cost_center_id => @scids).where("HOUR(finished_at) = #{hour} AND WEEKDAY(finished_at) = #{@weekday}").sum(:sum) %>
<% else %>
<% sum = @current_vendor.orders.existing.where(:paid => true, :settlement_id => @settlement_ids, :cost_center_id => @scids).where("HOUR(finished_at) = #{hour}").sum(:sum) %>
<% end %>
<%= "%10.10s:00  %s %7.2f\n" % [hour, friendly_unit, sum] %>
<% total += sum %>
<% end %>
<%= "%10.10s     %s %7.2f\n" % [I18n.t(:sum), friendly_unit, total] %>
<%= "\xc4" * 42 %>
<% end %>

<% if permit('statistics_statistic_category') #----------------------------  %>


<%= "\e!\x38" %>
<%= StatisticCategory.model_name.human %>

<%= "\e!\x00" %>
<% total = 0 %>
<% @statistic_categories.each do |cat| %>
<% sum = @current_vendor.items.existing.where(:refunded => nil, :settlement_id => @settlement_ids, :statistic_category_id => cat, :cost_center_id => @scids).sum(:sum) %>
<%= "%10.10s     %s %7.2f\n" % [cat.name, friendly_unit, sum] %>
<% total += sum %>
<% end %>
<%= "%10.10s     %s %7.2f\n" % [I18n.t(:sum), friendly_unit, total] %>
<%= "\xc4" * 42 %>
<% end %>

<% if permit('statistics_tax') #---------------------------- %>


<%= "\e!\x38" %>
<%= Tax.model_name.human %>

<%= "\e!\x00" %>
<% total = 0 %>
<% @taxes.each do |tax| %>
<% sum = @current_vendor.tax_items.existing.where(:refunded => nil, :settlement_id => @settlement_ids, :tax_id => tax, :cost_center_id => @scids).sum(:gro) %>
<%= "%10.10s     %s %7.2f\n" % [tax.name, friendly_unit, sum] %>
<% total += sum %>
<% end %>
<%= "%10.10s     %s %7.2f\n" % [I18n.t(:sum), friendly_unit, total] %>
<%= "\xc4" * 42 %>
<% end %>

<% if permit('statistics_category') #---------------------------- %>


<%= "\e!\x38" %>
<%= Category.model_name.human %>

<%= "\e!\x00" %>
<% total = 0 %>
<% @categories.each do |cat| %>
<% sum = @current_vendor.items.existing.where(:refunded => nil, :settlement_id => @settlement_ids, :category_id => cat, :cost_center_id => @scids).sum(:sum) %>
<%= "%10.10s     %s %7.2f\n" % [cat.name, friendly_unit, sum] %>
<% total += sum %>
<% end %>
<%= "%10.10s     %s %7.2f\n" % [I18n.t(:sum), friendly_unit, total] %>
<%= "\xc4" * 42 %>
<% end %>

<% if permit('statistics_sold_quantities') #----------------------------  %>


<%= "\e!\x38" %>
<%= I18n.t('various.sold_quantities') %>

<%= "\e!\x00" %>
<% @articles.each do |article| %>
<% sold_quantity = @current_vendor.items.existing.where(:refunded => nil, :article_id => article.id, :created_at => @from..@to).sum(:count) %>
<%= "%35.35s %5i\n" % [article.name, sold_quantity] %>
<% end %>

<% @quantities.each do |quantity| %>
<% sold_quantity = @current_vendor.items.existing.where(:refunded => nil, :quantity_id => quantity.id, :created_at => @from..@to).sum(:count) %>
<%= "%35.35s %5i\n" % ["#{ quantity.prefix } #{ quantity.article.name } #{ quantity.postfix }", sold_quantity] %>
<% end %>
<%= "\xc4" * 42 %>
<% end %>









<%= "\x1DV\x00\x0C" %>